# Milestone v1.1: Verificações no Portal Web

**Status:** ✅ SHIPPED 2026-01-27
**Phases:** 7-11
**Total Plans:** 11

## Overview

Este milestone transforma o portal web de ferramenta de cadastro em ferramenta de execução de qualidade. O núcleo é uma matriz interativa Serviços x Unidades onde engenheiros visualizam o estado de verificações da obra inteira e executam verificações individuais ou em lote. A construção segue ordem de dependência: fundação de dados, verificação individual (valida fluxo end-to-end), matriz visual, seleção/bulk, e integração com o app existente.

## Phases

### Phase 7: Fundação de Dados e Server Actions

**Goal:** Todas as operações de leitura e escrita de verificações estão disponíveis como Server Actions e queries reutilizáveis, prontas para qualquer UI consumir.
**Depends on:** Nenhuma (usa schema existente)
**Plans:** 3 plans

Plans:
- [x] 07-01-PLAN.md — Server Actions para CRUD de verificações e itens (DADOS-01, DADOS-02)
- [x] 07-02-PLAN.md — RPC PostgreSQL bulk_verificar + Server Action wrapper (DADOS-03)
- [x] 07-03-PLAN.md — Query otimizada da matriz + otimização RLS (DADOS-04)

**Completed:** 2026-01-26

---

### Phase 8: Verificação Individual

**Goal:** O engenheiro consegue abrir uma verificação de 1 serviço em 1 unidade, avaliar cada item individualmente, e o sistema determina o resultado final automaticamente.
**Depends on:** Fase 7 (Server Actions e queries)
**Plans:** 2 plans

Plans:
- [x] 08-01-PLAN.md — Página + header + checklist com toggles C/NC/NA + modal NC
- [x] 08-02-PLAN.md — Modal de detalhes + descrição geral + Exceção + reinspeção + estado travado

**Completed:** 2026-01-27

---

### Phase 9: Matriz de Verificações

**Goal:** O engenheiro visualiza o estado de todas as verificações da obra em uma única tela, com colunas de unidades agrupadas por agrupamento e indicadores visuais de status.
**Depends on:** Fase 7 (queries da matriz), Fase 8 (verificação individual para navegação)
**Plans:** 2 plans

Plans:
- [x] 09-01-PLAN.md — Camada de dados: migration tem_reinspecao + extensão da query + utilitário de status + tooltip
- [x] 09-02-PLAN.md — Página da matriz: grid CSS com sticky headers, heatmap 6 cores, tooltips, progresso e navegação

**Completed:** 2026-01-27

---

### Phase 10: Seleção e Operações em Massa

**Goal:** O engenheiro seleciona múltiplas células na matriz e executa verificações em lote com um único clique, com resolução inteligente de conflitos.
**Depends on:** Fase 9 (matriz renderizada), Fase 7 (RPC de bulk insert)
**Plans:** 2 plans

Plans:
- [x] 10-01-PLAN.md — Modo de seleção: estado, dual-mode click, seleção por headers, feedback visual (BULK-01 a BULK-05)
- [x] 10-02-PLAN.md — Toolbar flutuante + modal de verificação em massa + integração com bulkVerificar (BULK-06 a BULK-09)

**Completed:** 2026-01-27

---

### Phase 11: Navegação e Integração

**Goal:** As verificações estão completamente integradas ao app existente, com navegação fluida entre matriz e verificação individual, e o dashboard reflete dados reais.
**Depends on:** Fases 8, 9, 10 (todas as features de verificação)
**Plans:** 2 plans

Plans:
- [x] 11-01-PLAN.md — NC Feed: agrupamento na exibição, click-through para verificação individual, remoção de "Ver todas as NCs"
- [x] 11-02-PLAN.md — Navegação matriz ↔ individual: back button, preservação de estado, highlight animation, breadcrumb contextual

**Completed:** 2026-01-27

---

## Milestone Summary

**Key Decisions:**

- CSS Grid customizado para matriz (não AG Grid/TanStack Table) — controle total, economia de ~200KB
- Estado de seleção em useState local (não Zustand global) — estado transiente de UI
- Upload de fotos diferido para v1.2 — foco na verificação sem fotos primeiro
- RPC PostgreSQL para bulk insert — atomicidade e eficiência
- Padrão 'use server' em lib/supabase/actions/ — separa mutations de queries
- ActionResult<T> com { data } ou { error } — nunca throw em Server Actions
- Imutabilidade: verificação Conforme travada
- initPlan pattern em RLS policies — caching per-statement
- SECURITY DEFINER com autorização interna para bulk_verificar
- sessionStorage para preservação de estado da matriz
- highlight searchParam com auto-clear para feedback visual

**Issues Resolved:**

- Performance com 5000+ células (filtro por agrupamento como default)
- RLS lenta em operações bulk (initPlan pattern)
- Sticky headers quebrados (z-index em 3 níveis)
- Re-renders em cascata (event delegation + React.memo)

**Issues Deferred:**

- Upload de fotos por item de verificação (v1.2)
- Drag-to-select na matriz (v1.2)
- Atalhos de teclado na matriz (v1.2)

**Technical Debt Incurred:**

- atualizarStatusVerificacao exported but unused (status via triggers)
- DEV_CLIENTE_ID hardcoded (auth integration deferred from v1.0)

---

_For current project status, see .planning/ROADMAP.md_
