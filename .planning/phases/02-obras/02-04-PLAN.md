---
phase: 02-obras
plan: 04
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - arden/app/app/obras/[id]/page.tsx
  - arden/app/app/obras/[id]/_components/obra-header.tsx
  - arden/app/app/obras/[id]/_components/obra-info-card.tsx
autonomous: true

must_haves:
  truths:
    - "Usuario pode visualizar detalhes de uma obra"
    - "Clicar em obra na lista navega para pagina de detalhes"
    - "Pagina mostra todas informacoes da obra"
  artifacts:
    - path: "arden/app/app/obras/[id]/page.tsx"
      provides: "Obra detail page with data fetching"
      min_lines: 30
    - path: "arden/app/app/obras/[id]/_components/obra-header.tsx"
      provides: "Header with obra name and status badge"
      min_lines: 20
    - path: "arden/app/app/obras/[id]/_components/obra-info-card.tsx"
      provides: "Card displaying obra metadata"
      min_lines: 40
  key_links:
    - from: "arden/app/app/obras/[id]/page.tsx"
      to: "getObra query"
      via: "server-side data fetch"
      pattern: "getObra"
    - from: "arden/app/app/obras/_components/obras-table.tsx"
      to: "/app/obras/[id]"
      via: "router.push on row click"
      pattern: "router.push.*obras.*id"
---

<objective>
Create obra detail page showing all obra information. When user clicks on an obra in the list, they navigate to a detail view.

Purpose: "Entering obra context" - this page serves as the landing page when working within a specific obra. Full dashboard with KPIs comes in Phase 6.
Output: Working /app/obras/[id] page displaying obra name, status, metadata, and placeholder for future content.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-obras/02-RESEARCH.md
@.planning/phases/02-obras/02-CONTEXT.md
@.planning/phases/02-obras/02-02-SUMMARY.md
@arden/lib/supabase/queries/obras.ts
@docs/design/DESIGN-SYSTEM.md
@docs/product/04_NAVIGATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create obra detail page with components</name>
  <files>
    arden/app/app/obras/[id]/page.tsx
    arden/app/app/obras/[id]/_components/obra-header.tsx
    arden/app/app/obras/[id]/_components/obra-info-card.tsx
  </files>
  <action>
    Create the obra detail route with supporting components:

    **1. Create arden/app/app/obras/[id]/_components/obra-header.tsx:**
    Header component displaying obra name and status:
    ```typescript
    import { Badge } from '@/components/ui/badge'
    import type { Obra } from '@/lib/supabase/queries/obras'

    interface ObraHeaderProps {
      obra: Obra
    }

    export function ObraHeader({ obra }: ObraHeaderProps) {
      return (
        <div className="flex items-center justify-between">
          <div className="space-y-1">
            <h1 className="text-2xl font-semibold text-foreground">
              {obra.nome}
            </h1>
            {obra.codigo && (
              <p className="text-sm text-foreground-light">
                Codigo: {obra.codigo}
              </p>
            )}
          </div>
          <Badge variant={obra.arquivada ? 'secondary' : 'default'}>
            {obra.arquivada ? 'Arquivada' : 'Ativa'}
          </Badge>
        </div>
      )
    }
    ```

    **2. Create arden/app/app/obras/[id]/_components/obra-info-card.tsx:**
    Card showing obra metadata in organized layout:
    ```typescript
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
    import type { Obra } from '@/lib/supabase/queries/obras'

    interface ObraInfoCardProps {
      obra: Obra
    }

    const tipologiaLabels: Record<string, string> = {
      residencial_horizontal: 'Residencial Horizontal',
      residencial_vertical: 'Residencial Vertical',
      comercial: 'Comercial',
      retrofit: 'Retrofit',
      misto: 'Misto',
    }

    export function ObraInfoCard({ obra }: ObraInfoCardProps) {
      const formatDate = (dateString: string) => {
        return new Date(dateString).toLocaleDateString('pt-BR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
        })
      }

      return (
        <Card>
          <CardHeader>
            <CardTitle>Informacoes da Obra</CardTitle>
          </CardHeader>
          <CardContent>
            <dl className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              {obra.tipologia && (
                <div>
                  <dt className="text-sm font-medium text-foreground-light">
                    Tipologia
                  </dt>
                  <dd className="mt-1 text-sm text-foreground">
                    {tipologiaLabels[obra.tipologia] ?? obra.tipologia}
                  </dd>
                </div>
              )}

              {obra.responsavel_tecnico && (
                <div>
                  <dt className="text-sm font-medium text-foreground-light">
                    Responsavel Tecnico
                  </dt>
                  <dd className="mt-1 text-sm text-foreground">
                    {obra.responsavel_tecnico}
                  </dd>
                </div>
              )}

              <div>
                <dt className="text-sm font-medium text-foreground-light">
                  Data de Criacao
                </dt>
                <dd className="mt-1 text-sm text-foreground">
                  {formatDate(obra.created_at)}
                </dd>
              </div>

              <div>
                <dt className="text-sm font-medium text-foreground-light">
                  Ultima Atualizacao
                </dt>
                <dd className="mt-1 text-sm text-foreground">
                  {formatDate(obra.updated_at)}
                </dd>
              </div>
            </dl>
          </CardContent>
        </Card>
      )
    }
    ```

    **3. Create arden/app/app/obras/[id]/page.tsx:**
    Server Component that fetches obra and renders detail view:
    ```typescript
    import { notFound } from 'next/navigation'
    import { getObra } from '@/lib/supabase/queries/obras'
    import { ObraHeader } from './_components/obra-header'
    import { ObraInfoCard } from './_components/obra-info-card'

    interface ObraPageProps {
      params: Promise<{ id: string }>
    }

    export default async function ObraPage({ params }: ObraPageProps) {
      const { id } = await params

      let obra
      try {
        obra = await getObra(id)
      } catch (error) {
        notFound()
      }

      return (
        <div className="space-y-6 p-6">
          <ObraHeader obra={obra} />

          <div className="grid gap-6 md:grid-cols-2">
            <ObraInfoCard obra={obra} />

            {/* Placeholder for future content */}
            <div className="rounded-lg border border-dashed border-border p-6">
              <p className="text-center text-sm text-foreground-muted">
                KPIs e dashboard serao adicionados na Phase 6
              </p>
            </div>
          </div>

          {/* Placeholder for agrupamentos/unidades */}
          <div className="rounded-lg border border-dashed border-border p-6">
            <p className="text-center text-sm text-foreground-muted">
              Agrupamentos e unidades serao adicionados nas Phases 3 e 4
            </p>
          </div>
        </div>
      )
    }
    ```

    Notes:
    - Use Next.js 15 params as Promise (await params)
    - Call notFound() if getObra throws (invalid ID or no access)
    - Leave placeholder sections for Phase 3 (Agrupamentos), Phase 4 (Unidades), Phase 6 (Dashboard)
    - Per CONTEXT.md: this is "entering obra context" - sidebar behavior will change in future phases
    - If obra is archived, page still loads (read-only access per CONTEXT.md decision)
  </action>
  <verify>
    - Route responds: `curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app/obras/[valid-id]` returns 200
    - Invalid ID returns 404: `curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/app/obras/invalid` returns 404
    - Header shows obra name and status badge
    - Info card shows tipologia (if set), responsavel (if set), dates
    - Placeholder sections visible for future phases
  </verify>
  <done>
    /app/obras/[id] page renders obra details with header, info card, and placeholders for future content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire row click navigation from table</name>
  <files>arden/app/app/obras/_components/obras-table.tsx</files>
  <action>
    Ensure obras-table.tsx has proper row click navigation:

    The row click should already be implemented from Plan 02-02, but verify:
    - TableRow has `onClick={() => router.push(`/app/obras/${obra.id}`)}`
    - Cursor shows pointer on hover: `className="cursor-pointer"`
    - Dropdown trigger has `onClick={(e) => e.stopPropagation()}` to prevent navigation when clicking actions

    If not already implemented, add:
    ```typescript
    import { useRouter } from 'next/navigation'

    // Inside component:
    const router = useRouter()

    // On TableRow:
    <TableRow
      key={obra.id}
      className="cursor-pointer hover:bg-surface-200"
      onClick={() => router.push(`/app/obras/${obra.id}`)}
    >
    ```

    Test the full flow:
    1. Visit /app/obras
    2. Click on obra row
    3. Should navigate to /app/obras/[id]
    4. Back button should return to list
  </action>
  <verify>
    - Click obra row: navigates to /app/obras/[id]
    - Dropdown click does NOT navigate (stopPropagation works)
    - Browser back button returns to /app/obras
  </verify>
  <done>
    Row click navigates to obra detail page, dropdown actions don't trigger navigation.
  </done>
</task>

</tasks>

<verification>
- [ ] /app/obras/[id] route exists and responds with 200 for valid obra
- [ ] Invalid obra ID returns 404 page
- [ ] Header displays obra.nome and status badge
- [ ] Info card shows tipologia, responsavel_tecnico, dates
- [ ] Clicking row in obras table navigates to detail page
- [ ] Dropdown actions don't trigger navigation
- [ ] Archived obra detail page is accessible (read-only)
- [ ] Placeholder sections indicate future phases
</verification>

<success_criteria>
1. User clicks obra row in /app/obras table
2. Browser navigates to /app/obras/[id]
3. Page shows obra name as header with status badge
4. Info card displays available metadata (tipologia, responsavel, dates)
5. Placeholder sections visible for Agrupamentos/Unidades/Dashboard
6. User can navigate back to list via browser back button
</success_criteria>

<output>
After completion, create `.planning/phases/02-obras/02-04-SUMMARY.md`
</output>
