---
phase: 04.1-navegacao-contextual
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - arden/app/app/obras/[id]/unidades/page.tsx
  - arden/app/app/obras/[id]/unidades/_components/agrupamentos-page-client.tsx
  - arden/app/app/obras/[id]/unidades/_components/agrupamentos-panel.tsx
  - arden/app/app/obras/[id]/unidades/_components/agrupamentos-table.tsx
  - arden/app/app/obras/[id]/unidades/_components/agrupamento-form-modal.tsx
  - arden/app/app/obras/[id]/unidades/_components/delete-confirmation.tsx
  - arden/app/app/obras/[id]/unidades/_components/bulk-delete-confirmation.tsx
  - arden/app/app/obras/[id]/unidades/_components/sortable-agrupamento-item.tsx
  - arden/app/app/obras/[id]/unidades/_components/sortable-agrupamento-row.tsx
  - arden/app/app/obras/[id]/unidades/_components/split-view-layout.tsx
  - arden/app/app/obras/[id]/unidades/_components/unidade-delete-confirmation.tsx
  - arden/app/app/obras/[id]/unidades/_components/unidade-form-modal.tsx
  - arden/app/app/obras/[id]/unidades/_components/unidades-panel.tsx
  - arden/next.config.ts
autonomous: true

must_haves:
  truths:
    - "Route /app/obras/[id]/unidades displays unidades management page"
    - "Old route /app/obras/[id]/agrupamentos redirects to /app/obras/[id]/unidades"
    - "All component imports still work after rename"
    - "Unidades/agrupamentos functionality unchanged"
  artifacts:
    - path: "arden/app/app/obras/[id]/unidades/page.tsx"
      provides: "Renamed unidades page"
      min_lines: 20
    - path: "arden/next.config.ts"
      provides: "Redirect configuration"
      contains: "agrupamentos.*unidades"
  key_links:
    - from: "arden/app/app/obras/[id]/unidades/page.tsx"
      to: "@/lib/supabase/queries/agrupamentos"
      via: "import listAgrupamentos"
      pattern: "import.*listAgrupamentos"
---

<objective>
Rename the route from `/agrupamentos` to `/unidades` to match the user-facing terminology.

Purpose: "Unidades" is what users verify - agrupamentos are just organizational structure. The sidebar will link to "Unidades" so the route must match.

Output: Renamed route folder with redirect for old URLs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.1-navegacao-contextual/04.1-CONTEXT.md
@arden/app/app/obras/[id]/agrupamentos/page.tsx
@arden/next.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename agrupamentos folder to unidades</name>
  <files>
    arden/app/app/obras/[id]/unidades/
  </files>
  <action>
Rename the entire folder:

```bash
cd arden/app/app/obras/[id]
mv agrupamentos unidades
```

This moves all files including:
- page.tsx
- _components/agrupamentos-page-client.tsx
- _components/agrupamentos-panel.tsx
- _components/agrupamentos-table.tsx
- _components/agrupamento-form-modal.tsx
- _components/delete-confirmation.tsx
- _components/bulk-delete-confirmation.tsx
- _components/sortable-agrupamento-item.tsx
- _components/sortable-agrupamento-row.tsx
- _components/split-view-layout.tsx
- _components/unidade-delete-confirmation.tsx
- _components/unidade-form-modal.tsx
- _components/unidades-panel.tsx

No internal code changes needed - the route path changes but component logic stays the same.
  </action>
  <verify>
Folder exists at new path:
```bash
ls arden/app/app/obras/[id]/unidades/page.tsx
ls arden/app/app/obras/[id]/unidades/_components/
```
Old folder no longer exists:
```bash
ls arden/app/app/obras/[id]/agrupamentos 2>&1 | grep -q "No such file" && echo "Old folder removed"
```
  </verify>
  <done>
Route folder renamed from agrupamentos to unidades. All components moved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add redirect for old URL</name>
  <files>
    arden/next.config.ts
  </files>
  <action>
Update `arden/next.config.ts` to add a redirect from the old route to the new route.

Read existing config first, then add redirects array:

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  // ... existing config ...
  async redirects() {
    return [
      {
        source: '/app/obras/:id/agrupamentos',
        destination: '/app/obras/:id/unidades',
        permanent: true,
      },
    ]
  },
};

export default nextConfig;
```

This ensures any bookmarked or cached URLs continue to work.
  </action>
  <verify>
Config has redirect:
```bash
grep -q "agrupamentos.*unidades" arden/next.config.ts && echo "Redirect configured"
```
Build succeeds:
```bash
cd arden && npm run build 2>&1 | tail -5
```
  </verify>
  <done>
Redirect configured for /agrupamentos -> /unidades. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify app builds and routes work</name>
  <files>
    (no new files - verification only)
  </files>
  <action>
Run build to verify:
1. No broken imports after rename
2. Next.js recognizes the new route
3. Redirect config is valid

```bash
cd arden && npm run build
```

If build fails due to import issues, fix any relative imports that might reference the old path.

Also check TypeScript:
```bash
cd arden && npx tsc --noEmit --skipLibCheck
```
  </action>
  <verify>
Build succeeds:
```bash
cd arden && npm run build 2>&1 | grep -E "(Compiled|Error)" | head -5
```
No TypeScript errors.
  </verify>
  <done>
App builds successfully with renamed route. No broken imports.
  </done>
</task>

</tasks>

<verification>
Full verification:
```bash
# Folder structure correct
ls -la arden/app/app/obras/[id]/

# New route exists
ls arden/app/app/obras/[id]/unidades/page.tsx

# Old route gone
ls arden/app/app/obras/[id]/agrupamentos 2>&1

# Redirect in config
grep -A3 "redirects" arden/next.config.ts

# Build passes
cd arden && npm run build
```
</verification>

<success_criteria>
- [ ] Folder `arden/app/app/obras/[id]/unidades/` exists with all components
- [ ] Folder `arden/app/app/obras/[id]/agrupamentos/` no longer exists
- [ ] `next.config.ts` has redirect from agrupamentos to unidades
- [ ] `npm run build` completes successfully
- [ ] No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-navegacao-contextual/04.1-02-SUMMARY.md`
</output>
