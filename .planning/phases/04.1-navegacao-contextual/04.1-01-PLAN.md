---
phase: 04.1-navegacao-contextual
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - arden/components/navigation/sidebar-item.tsx
  - arden/components/navigation/sidebar-global.tsx
  - arden/components/navigation/sidebar-obra.tsx
  - arden/components/navigation/back-to-global.tsx
  - arden/components/navigation/breadcrumb.tsx
  - arden/components/navigation/status-indicator.tsx
  - arden/components/navigation/index.ts
autonomous: true

must_haves:
  truths:
    - "Navigation components exist and export correctly"
    - "SidebarItem renders with active state based on pathname"
    - "SidebarGlobal shows global nav items with badges"
    - "SidebarObra shows obra-specific nav items with obraId"
    - "BackToGlobal links to /app/obras"
    - "Breadcrumb shows construtora / obra / section path"
  artifacts:
    - path: "arden/components/navigation/sidebar-item.tsx"
      provides: "Reusable nav item with active detection"
      exports: ["SidebarItem"]
    - path: "arden/components/navigation/sidebar-global.tsx"
      provides: "Global context sidebar"
      exports: ["SidebarGlobal"]
    - path: "arden/components/navigation/sidebar-obra.tsx"
      provides: "Obra context sidebar"
      exports: ["SidebarObra"]
    - path: "arden/components/navigation/breadcrumb.tsx"
      provides: "Context-aware breadcrumb"
      exports: ["Breadcrumb"]
    - path: "arden/components/navigation/index.ts"
      provides: "Barrel exports"
      exports: ["SidebarItem", "SidebarGlobal", "SidebarObra", "BackToGlobal", "Breadcrumb", "StatusIndicator"]
  key_links:
    - from: "arden/components/navigation/sidebar-item.tsx"
      to: "next/navigation"
      via: "usePathname for active detection"
      pattern: "usePathname"
    - from: "arden/components/navigation/sidebar-obra.tsx"
      to: "sidebar-item.tsx"
      via: "import SidebarItem"
      pattern: "import.*SidebarItem"
---

<objective>
Create modular navigation components for the dual-context sidebar system.

Purpose: Provide reusable, well-typed navigation components that the layout can compose to switch between global and obra contexts.

Output: `arden/components/navigation/` folder with 6 components and barrel export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.1-navegacao-contextual/04.1-RESEARCH.md
@.planning/phases/04.1-navegacao-contextual/04.1-CONTEXT.md
@arden/app/app/layout.tsx
@arden/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SidebarItem and StatusIndicator components</name>
  <files>
    arden/components/navigation/sidebar-item.tsx
    arden/components/navigation/status-indicator.tsx
  </files>
  <action>
Create `arden/components/navigation/` folder.

**SidebarItem (sidebar-item.tsx):**
- 'use client' directive (uses usePathname)
- Props: href, icon (LucideIcon), label, expanded (boolean), badge? (string), exact? (boolean)
- Use `usePathname()` for active detection:
  - If `exact=true`: `pathname === href`
  - Else: `pathname === href || pathname.startsWith(\`\${href}/\`)`
- Render as `<Link>` from next/link
- Styling: Use `cn()` from lib/utils
  - Active: `bg-sidebar-accent text-foreground`
  - Inactive: `text-foreground-light hover:text-foreground hover:bg-surface-100`
- When expanded, show label and optional badge
- Badge: `text-[10px] bg-surface-200 px-1.5 py-0.5 rounded text-foreground-muted whitespace-nowrap`

**StatusIndicator (status-indicator.tsx):**
- Props: expanded (boolean)
- For now, hardcode `isOnline = true` (TODO comment for future connection detection)
- Green dot when online, red when offline
- When expanded, show text "Online" or "Offline"
  </action>
  <verify>
Files exist at correct paths:
- `ls arden/components/navigation/sidebar-item.tsx`
- `ls arden/components/navigation/status-indicator.tsx`
No TypeScript errors: `cd arden && npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "(navigation|Error)" || echo "No errors"`
  </verify>
  <done>
SidebarItem and StatusIndicator components exist with proper typing and styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SidebarGlobal and SidebarObra components</name>
  <files>
    arden/components/navigation/sidebar-global.tsx
    arden/components/navigation/sidebar-obra.tsx
    arden/components/navigation/back-to-global.tsx
  </files>
  <action>
**SidebarGlobal (sidebar-global.tsx):**
- 'use client' directive
- Props: expanded (boolean)
- Internal state: none (stateless presentation)
- Define `globalNavItems` array:
  - { icon: Home, label: 'Home', href: '/app', exact: true }
  - { icon: LayoutDashboard, label: 'Dashboard', href: '/app/dashboard', badge: 'Em breve' }
  - { icon: Building2, label: 'Obras', href: '/app/obras' }
  - { icon: Library, label: 'Biblioteca FVS', href: '/app/biblioteca', badge: 'Em breve' }
  - (separator)
  - { icon: Users, label: 'Usuarios', href: '/app/usuarios', badge: 'Em breve' }
- Define `bottomNavItems`:
  - { icon: Settings, label: 'Configuracoes', href: '/app/configuracoes', badge: 'Em breve' }
- Render structure:
  - Top: flex-1 nav with main items + separator + secondary items
  - StatusIndicator
  - Bottom: border-t with settings

**SidebarObra (sidebar-obra.tsx):**
- 'use client' directive
- Props: obraId (string), expanded (boolean)
- Define `obraNavItems(obraId)` function returning:
  - { icon: LayoutDashboard, label: 'Dashboard', href: \`/app/obras/\${obraId}\`, exact: true }
  - (separator label: "Operacao")
  - { icon: Wrench, label: 'Servicos', href: \`/app/obras/\${obraId}/servicos\`, badge: 'Em breve' }
  - { icon: Building2, label: 'Unidades', href: \`/app/obras/\${obraId}/unidades\` }
  - { icon: ClipboardCheck, label: 'Verificacoes', href: \`/app/obras/\${obraId}/verificacoes\`, badge: 'Em breve' }
  - { icon: AlertTriangle, label: 'NCs', href: \`/app/obras/\${obraId}/ncs\`, badge: 'Em breve' }
  - (separator label: "Admin")
  - { icon: FileText, label: 'Relatorios', href: \`/app/obras/\${obraId}/relatorios\`, badge: 'Em breve' }
  - { icon: Users, label: 'Equipe', href: \`/app/obras/\${obraId}/equipe\`, badge: 'Em breve' }
  - { icon: Settings, label: 'Configuracoes', href: \`/app/obras/\${obraId}/configuracoes\`, badge: 'Em breve' }
- Render structure:
  - Top: flex-1 nav with items grouped by separators
  - StatusIndicator
  - Bottom: BackToGlobal component

**BackToGlobal (back-to-global.tsx):**
- 'use client' directive
- Props: expanded (boolean)
- Link to "/app/obras"
- Icon: ArrowLeft from lucide-react
- Text when expanded: "Visao Global"
- Styled same as inactive SidebarItem
  </action>
  <verify>
Files exist:
- `ls arden/components/navigation/sidebar-global.tsx`
- `ls arden/components/navigation/sidebar-obra.tsx`
- `ls arden/components/navigation/back-to-global.tsx`
No TypeScript errors: `cd arden && npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "(navigation|Error)" || echo "No errors"`
  </verify>
  <done>
SidebarGlobal shows global nav, SidebarObra shows obra-specific nav with BackToGlobal button.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Breadcrumb and barrel export</name>
  <files>
    arden/components/navigation/breadcrumb.tsx
    arden/components/navigation/index.ts
  </files>
  <action>
**Breadcrumb (breadcrumb.tsx):**
- 'use client' directive
- Props: obraName? (string | null) - passed from parent when in obra context
- Use `usePathname()` and `useParams<{ id?: string }>()`
- Logic:
  - Always start with construtora name crumb (hardcode "Pfeil" for now, TODO comment for auth context)
  - If params.id exists and obraName provided:
    - Add obra crumb: { label: obraName, href: \`/app/obras/\${params.id}\` }
    - Parse section from last pathname segment (if not the id itself)
    - Add section crumb if applicable
- Section labels map:
  ```typescript
  const sectionLabels: Record<string, string> = {
    unidades: 'Unidades',
    servicos: 'Servicos',
    verificacoes: 'Verificacoes',
    ncs: 'Nao-Conformidades',
    relatorios: 'Relatorios',
    equipe: 'Equipe',
    configuracoes: 'Configuracoes',
  }
  ```
- Render: nav with crumbs separated by "/" (text-foreground-muted)
- Last crumb: text-foreground (current page, not linked)
- Other crumbs: Link with text-foreground-light hover:text-foreground

**Barrel export (index.ts):**
```typescript
export { SidebarItem } from './sidebar-item'
export { SidebarGlobal } from './sidebar-global'
export { SidebarObra } from './sidebar-obra'
export { BackToGlobal } from './back-to-global'
export { Breadcrumb } from './breadcrumb'
export { StatusIndicator } from './status-indicator'
```
  </action>
  <verify>
All files exist:
- `ls arden/components/navigation/breadcrumb.tsx`
- `ls arden/components/navigation/index.ts`
TypeScript compiles: `cd arden && npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "(navigation|Error)" || echo "No errors"`
Import works: Check barrel exports are correct.
  </verify>
  <done>
Breadcrumb component shows context-aware path. All components exported from index.ts.
  </done>
</task>

</tasks>

<verification>
Run TypeScript check on navigation folder:
```bash
cd arden && npx tsc --noEmit --skipLibCheck
```

Verify all exports:
```bash
ls -la arden/components/navigation/
```

Expected: 7 files (6 components + index.ts)
</verification>

<success_criteria>
- [ ] `arden/components/navigation/` folder exists with 7 files
- [ ] All components use 'use client' directive where needed
- [ ] SidebarItem uses usePathname for active detection
- [ ] SidebarGlobal has correct global nav items with badges
- [ ] SidebarObra has correct obra nav items with separators
- [ ] BackToGlobal links to /app/obras
- [ ] Breadcrumb parses pathname and shows hierarchy
- [ ] No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-navegacao-contextual/04.1-01-SUMMARY.md`
</output>
