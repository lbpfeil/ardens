---
phase: 04.1-navegacao-contextual
plan: 04
type: execute
wave: 2
depends_on: ["04.1-02"]
files_modified:
  - arden/app/app/obras/[id]/page.tsx
  - arden/app/app/obras/[id]/_components/obra-header.tsx
  - arden/app/app/obras/[id]/configuracoes/page.tsx
  - docs/product/04_NAVIGATION.md
autonomous: true

must_haves:
  truths:
    - "Obra detail page (/app/obras/[id]) shows dashboard with KPI placeholders"
    - "Obra cadastral info moved to /app/obras/[id]/configuracoes"
    - "04_NAVIGATION.md updated with MVP navigation decisions"
  artifacts:
    - path: "arden/app/app/obras/[id]/page.tsx"
      provides: "Obra dashboard page"
      min_lines: 25
    - path: "arden/app/app/obras/[id]/configuracoes/page.tsx"
      provides: "Obra settings page with cadastral info"
      min_lines: 30
    - path: "docs/product/04_NAVIGATION.md"
      provides: "Updated navigation documentation"
      contains: "MVP"
  key_links:
    - from: "arden/app/app/obras/[id]/page.tsx"
      to: "@/lib/supabase/queries/obras"
      via: "import getObra"
      pattern: "import.*getObra"
---

<objective>
Transform obra detail page into dashboard and update navigation documentation.

Purpose: The obra detail page becomes the "Dashboard" entry point. Cadastral information moves to "Configuracoes". Documentation reflects MVP decisions.

Output: Dashboard-focused obra page, new configuracoes page, updated 04_NAVIGATION.md.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.1-navegacao-contextual/04.1-CONTEXT.md
@.planning/phases/04.1-navegacao-contextual/04.1-02-SUMMARY.md
@arden/app/app/obras/[id]/page.tsx
@arden/app/app/obras/[id]/_components/obra-header.tsx
@arden/app/app/obras/[id]/_components/obra-info-card.tsx
@docs/product/04_NAVIGATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Transform obra page into dashboard</name>
  <files>
    arden/app/app/obras/[id]/page.tsx
    arden/app/app/obras/[id]/_components/obra-header.tsx
  </files>
  <action>
**Update obra page (page.tsx):**

Transform from detail view to dashboard view with placeholder KPI cards.

```tsx
import { notFound } from 'next/navigation'
import { getObra } from '@/lib/supabase/queries/obras'
import { ObraHeader } from './_components/obra-header'

interface ObraPageProps {
  params: Promise<{ id: string }>
}

export default async function ObraPage({ params }: ObraPageProps) {
  const { id } = await params

  let obra
  try {
    obra = await getObra(id)
  } catch {
    notFound()
  }

  return (
    <div className="space-y-6 p-6">
      <ObraHeader obra={obra} />

      {/* KPI Cards - Placeholders */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <KPICard
          title="Taxa de Conformidade"
          value="--"
          description="Sera calculado com verificacoes"
        />
        <KPICard
          title="IRS"
          value="--"
          description="Indice de Retrabalho"
        />
        <KPICard
          title="Verificacoes Pendentes"
          value="--"
          description="Aguardando inspecao"
        />
        <KPICard
          title="Verificacoes Concluidas"
          value="--"
          description="Ultimos 30 dias"
        />
      </div>

      {/* Recent NCs placeholder */}
      <div className="rounded-lg border border-dashed border-border p-6">
        <h3 className="text-sm font-medium text-foreground mb-2">Ultimas NCs</h3>
        <p className="text-sm text-foreground-muted">
          Nenhuma nao-conformidade registrada ainda.
        </p>
      </div>

      {/* Quick Actions */}
      <div className="rounded-lg border border-dashed border-border p-6">
        <h3 className="text-sm font-medium text-foreground mb-2">Acoes Rapidas</h3>
        <p className="text-sm text-foreground-muted">
          Links para unidades, servicos e verificacoes serao adicionados.
        </p>
      </div>
    </div>
  )
}

// Simple KPI card component (inline for now)
function KPICard({ title, value, description }: { title: string; value: string; description: string }) {
  return (
    <div className="rounded-lg border border-border bg-surface-100 p-4">
      <p className="text-xs text-foreground-muted uppercase tracking-wide">{title}</p>
      <p className="text-2xl font-semibold text-foreground mt-1">{value}</p>
      <p className="text-xs text-foreground-muted mt-1">{description}</p>
    </div>
  )
}
```

**Update ObraHeader (obra-header.tsx):**

Simplify header - remove edit/archive buttons (those belong in Configuracoes now).

Keep:
- Obra name as title
- Status badge
- Tipologia/codigo if available

Remove:
- Edit button
- Archive button
- Any actions that modify obra data

The header should be informational only on the dashboard. Actions move to Configuracoes.
  </action>
  <verify>
Page renders:
```bash
cd arden && npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "(obras|Error)" || echo "No errors"
```
  </verify>
  <done>
Obra page transformed into dashboard with KPI placeholders. Header simplified.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create configuracoes page</name>
  <files>
    arden/app/app/obras/[id]/configuracoes/page.tsx
  </files>
  <action>
Create new folder and page for obra settings.

**Create: `arden/app/app/obras/[id]/configuracoes/page.tsx`**

This page shows:
1. Obra cadastral information (ObraInfoCard from existing _components)
2. Edit and archive actions (moved from header)

```tsx
import { notFound } from 'next/navigation'
import { getObra } from '@/lib/supabase/queries/obras'
import { ObraInfoCard } from '../_components/obra-info-card'

interface ConfiguracoesPageProps {
  params: Promise<{ id: string }>
}

export default async function ConfiguracoesPage({ params }: ConfiguracoesPageProps) {
  const { id } = await params

  let obra
  try {
    obra = await getObra(id)
  } catch {
    notFound()
  }

  return (
    <div className="space-y-6 p-6">
      <div>
        <h1 className="text-lg font-semibold text-foreground">Configuracoes</h1>
        <p className="text-sm text-foreground-muted">Gerencie as informacoes da obra</p>
      </div>

      {/* Cadastral Info */}
      <div className="max-w-xl">
        <ObraInfoCard obra={obra} />
      </div>

      {/* Placeholders for future settings */}
      <div className="rounded-lg border border-dashed border-border p-6">
        <h3 className="text-sm font-medium text-foreground mb-2">Servicos Habilitados</h3>
        <p className="text-sm text-foreground-muted">
          Configuracao de servicos FVS sera adicionada na Phase 5.
        </p>
      </div>

      <div className="rounded-lg border border-dashed border-border p-6">
        <h3 className="text-sm font-medium text-foreground mb-2">Estrutura da Obra</h3>
        <p className="text-sm text-foreground-muted">
          Configuracoes de agrupamentos e unidades. Acesse pelo menu "Unidades".
        </p>
      </div>
    </div>
  )
}
```

Note: ObraInfoCard already has edit functionality via modal. Keep that as-is.
  </action>
  <verify>
Page exists and compiles:
```bash
ls arden/app/app/obras/[id]/configuracoes/page.tsx
cd arden && npx tsc --noEmit --skipLibCheck
```
  </verify>
  <done>
Configuracoes page created with obra info card and placeholders.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update navigation documentation</name>
  <files>
    docs/product/04_NAVIGATION.md
  </files>
  <action>
Update `docs/product/04_NAVIGATION.md` to reflect MVP implementation decisions.

**Changes to make:**

1. Add "MVP Status" section at the top noting what's implemented vs placeholder

2. Update "Contexto: Visao Global" section:
   - Mark which items are implemented: Home, Obras
   - Mark which are placeholders: Dashboard, Biblioteca FVS, Usuarios, Configuracoes

3. Update "Contexto: Obra Especifica" section:
   - Mark implemented: Dashboard (basic), Unidades
   - Mark placeholders: Servicos, Verificacoes, NCs, Relatorios, Equipe, Configuracoes

4. Add "MVP Decisions" section documenting:
   - Route renamed from /agrupamentos to /unidades
   - Sidebar items use "Em breve" badge for placeholders
   - Obra detail page is now Dashboard
   - Cadastral info moved to Configuracoes
   - Breadcrumb shows: Construtora / Obra / Section

5. Remove or mark as "Future" any references to:
   - Secondary sidebar (deferred)
   - Lista rapida de obras for context switching (deferred)
   - Branch selector (not applicable)

**Keep the existing structure** but add annotations. Don't delete the full vision docs - just mark current status.
  </action>
  <verify>
Doc updated:
```bash
grep -q "MVP" docs/product/04_NAVIGATION.md && echo "MVP section added"
grep -q "Em breve" docs/product/04_NAVIGATION.md && echo "Badge pattern documented"
```
  </verify>
  <done>
04_NAVIGATION.md updated with MVP status and implementation decisions.
  </done>
</task>

</tasks>

<verification>
Full verification:
```bash
# All files exist
ls arden/app/app/obras/[id]/page.tsx
ls arden/app/app/obras/[id]/configuracoes/page.tsx
ls docs/product/04_NAVIGATION.md

# TypeScript
cd arden && npx tsc --noEmit --skipLibCheck

# Build
cd arden && npm run build
```

Content verification:
```bash
# Dashboard has KPI cards
grep -q "KPICard" arden/app/app/obras/[id]/page.tsx

# Configuracoes uses ObraInfoCard
grep -q "ObraInfoCard" arden/app/app/obras/[id]/configuracoes/page.tsx

# Docs mention MVP
grep -q "MVP" docs/product/04_NAVIGATION.md
```
</verification>

<success_criteria>
- [ ] Obra page (`/app/obras/[id]`) shows dashboard with KPI placeholders
- [ ] ObraHeader simplified (no edit/archive buttons)
- [ ] Configuracoes page (`/app/obras/[id]/configuracoes`) exists with ObraInfoCard
- [ ] 04_NAVIGATION.md updated with MVP status and decisions
- [ ] TypeScript compiles
- [ ] Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-navegacao-contextual/04.1-04-SUMMARY.md`
</output>
