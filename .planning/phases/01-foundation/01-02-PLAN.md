---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - arden/package.json
  - arden/lib/validations/index.ts
  - arden/lib/validations/common.ts
  - arden/lib/validations/obra.ts
  - arden/components/forms/obra-form.tsx
autonomous: true

must_haves:
  truths:
    - "Forms validam input automaticamente via schema Zod"
    - "Erros de validacao aparecem inline no campo correspondente"
    - "Dados do form tem tipos TypeScript inferidos do schema"
  artifacts:
    - path: "arden/lib/validations/common.ts"
      provides: "Schemas Zod reutilizaveis (strings, dates, ids)"
      exports: ["requiredString", "optionalString", "dateString"]
    - path: "arden/lib/validations/obra.ts"
      provides: "Schema de validacao para formulario de obra"
      exports: ["obraSchema", "ObraFormData"]
    - path: "arden/components/forms/obra-form.tsx"
      provides: "Componente form exemplo usando RHF + Zod"
      exports: ["ObraForm"]
  key_links:
    - from: "arden/components/forms/obra-form.tsx"
      to: "arden/lib/validations/obra.ts"
      via: "zodResolver import"
      pattern: "zodResolver\\(obraSchema\\)"
    - from: "arden/lib/validations/obra.ts"
      to: "arden/lib/validations/common.ts"
      via: "schema composition"
      pattern: "from.*common"
---

<objective>
Configurar React Hook Form + Zod para validacao de formularios no Arden FVS.

Purpose: Estabelecer padrao de validacao type-safe que sera usado em todos os formularios da aplicacao (Obras, Agrupamentos, Unidades, Servicos).

Output: Estrutura de validations funcional com form exemplo demonstrando o padrao.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md

# UI components existentes
@arden/components/ui/button.tsx
@arden/components/ui/input.tsx
@arden/components/ui/label.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Instalar dependencias e criar estrutura de validations</name>
  <files>
    arden/package.json
    arden/lib/validations/index.ts
    arden/lib/validations/common.ts
    arden/lib/validations/obra.ts
  </files>
  <action>
1. Instalar dependencias:
   ```bash
   cd arden && npm install react-hook-form@^7.71.0 zod@^3.23.8 @hookform/resolvers@^3.9.0
   ```
   IMPORTANTE: Usar Zod v3.23.x (NAO v4.x) - ha problemas de compatibilidade com @hookform/resolvers.

2. Criar diretorio `arden/lib/validations/`

3. Criar `arden/lib/validations/common.ts`:
   - Schemas base reutilizaveis:
     - `requiredString(min, max, field)` - retorna z.string() com min/max e mensagens em portugues
     - `optionalString(max)` - retorna z.string().max().optional()
     - `dateString()` - valida formato YYYY-MM-DD
     - `uuidString()` - valida formato UUID
   - Mensagens de erro em portugues (ex: "Nome deve ter no minimo 3 caracteres")

4. Criar `arden/lib/validations/obra.ts`:
   - Importar helpers de common.ts
   - Schema `obraSchema` com campos:
     - `nome`: string, min 3, max 100
     - `codigo`: string, max 20, opcional
     - `endereco`: string, min 5
     - `dataInicio`: string formato YYYY-MM-DD
     - `responsavel`: string, min 2
   - Exportar type `ObraFormData = z.infer<typeof obraSchema>`

5. Criar `arden/lib/validations/index.ts`:
   - Re-exportar tudo de common e obra
  </action>
  <verify>
    - `npm ls react-hook-form zod @hookform/resolvers` mostra versoes corretas
    - `cd arden && npx tsc --noEmit` compila sem erros
    - Schemas exportam tipos corretos
  </verify>
  <done>
    React Hook Form, Zod e resolvers instalados. Estrutura de validations criada com schema de obra.
  </done>
</task>

<task type="auto">
  <name>Task 2: Criar ObraForm exemplo demonstrando o padrao</name>
  <files>
    arden/components/forms/obra-form.tsx
  </files>
  <action>
1. Criar diretorio `arden/components/forms/`

2. Criar `arden/components/forms/obra-form.tsx`:
   - Marcar como 'use client'
   - Importar useForm de react-hook-form
   - Importar zodResolver de @hookform/resolvers/zod
   - Importar obraSchema e ObraFormData de @/lib/validations
   - Importar componentes UI: Button, Input, Label de @/components/ui

   Interface ObraFormProps:
   - `defaultValues?: Partial<ObraFormData>`
   - `onSubmit: (data: ObraFormData) => Promise<void>`
   - `isEditing?: boolean` (para texto do botao)

   Implementacao:
   - useForm com resolver: zodResolver(obraSchema)
   - defaultValues para TODOS os campos (previne warnings controlled/uncontrolled)
   - Campos com:
     - Label
     - Input com {...register('campo')}
     - Classe condicional para borda vermelha se erro: `errors.campo ? 'border-destructive' : ''`
     - Mensagem de erro abaixo do input: `{errors.campo && <p className="text-destructive text-xs">{errors.campo.message}</p>}`
   - Button submit com disabled={isSubmitting} e texto dinamico

   Campos a renderizar: nome, codigo (opcional), endereco, dataInicio (type="date"), responsavel

   Usar variaveis CSS do design system:
   - `text-destructive` para erros
   - `border-destructive` para borda de campo invalido
   - `space-y-4` para espacamento entre campos
   - `space-y-2` para espacamento label/input

Este componente serve como EXEMPLO do padrao. Sera usado como referencia para criar outros forms.
  </action>
  <verify>
    - Arquivo `arden/components/forms/obra-form.tsx` existe
    - `cd arden && npm run build` completa sem erros
    - Componente pode ser importado sem erros de tipo
  </verify>
  <done>
    ObraForm criado demonstrando padrao de validacao com RHF + Zod. Pronto para uso como referencia.
  </done>
</task>

</tasks>

<verification>
Verificacao final da infraestrutura de Forms:

1. **Estrutura de arquivos:**
   ```
   arden/lib/validations/
   ├── common.ts    # Schemas base reutilizaveis
   ├── obra.ts      # Schema especifico de obra
   └── index.ts     # Re-exports

   arden/components/forms/
   └── obra-form.tsx  # Form exemplo
   ```

2. **Teste de tipagem:**
   - ObraFormData tem tipos corretos inferidos
   - Erros de form tem tipagem correta

3. **Build check:**
   - `npm run build` passa
   - Nenhum warning de tipos
</verification>

<success_criteria>
- [ ] react-hook-form ^7.71.0 instalado
- [ ] zod ^3.23.8 instalado (NAO v4.x)
- [ ] @hookform/resolvers ^3.9.0 instalado
- [ ] common.ts exporta helpers de validacao reutilizaveis
- [ ] obra.ts exporta obraSchema e ObraFormData
- [ ] ObraForm usa zodResolver e mostra erros inline
- [ ] Build passa sem erros
</success_criteria>

<output>
Apos conclusao, criar `.planning/phases/01-foundation/01-02-SUMMARY.md` seguindo o template.
</output>
